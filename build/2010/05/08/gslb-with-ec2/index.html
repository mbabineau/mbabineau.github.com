
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>GSLB with EC2</title>
    <meta name="description" content="Global Server Load Balancing (GSLB) on Amazon EC2">
    <meta name="author" content="Mike Babineau">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/pygments.css" rel="stylesheet">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">mikebabineau</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header">
  <h1>GSLB with EC2 <small>Improving Global Application Performance, continued</small></h1>
</div>

<div class="row">
  <div class="span8">
    <p><em>(originally posted on Bizo&#8217;s dev blog <a href='http://dev.bizo.com/2010/05/improving-global-application.html'>here</a>)</em></p>

<p>This is an unofficial continuation of Amazon&#8217;s <a href='http://aws.typepad.com/aws/2010/05/improving-global-application-performance.html'>blog post</a> on the use of Amazon CloudFront to improve application performance.</p>

<p>CloudFront is a great CDN to consider, especially if you&#8217;re already an Amazon Web Services customer. Unfortunately, it can only be used for static content; the loading of dynamic content will still be slower for far-away users than for nearby ones. Simply put, users in India will still see a half-second delay when loading the dynamic portions of your US-based website. And a half-second delay has a <a href='http://glinden.blogspot.com/2006/11/marissa-mayer-at-web-20.html'>measurable impact on revenue</a>.</p>

<p>Let&#8217;s talk about speeding up dynamic content, globally.</p>

<p>The typical EC2 implementation comprises instances deployed in a single region. Such a deployment may span several availability zones for redundancy, but all instances are in roughly the same place, geographically.</p>

<p>This is fine for EC2-hosted apps with nominal revenue or a highly localized user base. But what if your users are spread around the globe? The problem can&#8217;t be solved by moving your application to another region - that would simply shift the extra latency to another group.</p>

<p>For a distributed audience, you need a distributed infrastructure. But you can&#8217;t simply launch servers around the world and expect traffic to reach them. Enter Global Server Load Balancing (GSLB).</p>

<h3 id='a_primer_on_gslb'>A primer on GSLB</h3>

<p>Broadly, GSLB is used to intelligently distribute traffic across multiple datacenters based on some set of rules.</p>

<p>With GSLB, your traffic distribution can go from this: <img alt='without gslb' src='/img/gslb-map-without_gslb.gif' /></p>

<p>To this: <img alt='with gslb' src='/img/gslb-map-with_gslb.gif' /></p>

<p>GSLB can be implemented as a feature of a physical device (including certain high-end load balancers) or as a part of a DNS service. Since we EC2 users are clearly not interested in hardware, our focus is on the latter: DNS-based GSLB.</p>

<p>Standard DNS behavior is for an authoritative nameserver to, given queries for a certain record, always return the same result. A DNS-based implementation of GSLB would alter this behavior so that queries return context-dependent results.</p>

<p>Example:<br />User A queries DNS for gslb.example.com &#8211; response: 10.1.0.1<br />User B queries DNS for gslb.example.com &#8211; response: 10.2.0.1</p>

<p>But what context should we use? Since our goal is to reduce wire latency, we should route users to the closest datacenter. IP blocks can be mapped geographically &#8211; by examining a requestor&#8217;s IP address, a GSLB service can return a geo-targeted response.</p>

<p>With geo-targeted DNS, our example would be:<br />User A (in China) queries DNS for geo.example.com &#8211; response: 10.1.0.1<br />User B (in Spain) queries DNS for geo.example.com &#8211; response: 10.2.0.1</p>

<h3 id='getting_started'>Getting started</h3>

<p>At a high level, implementation can be broken down into two steps:</p>

<ol>
<li>Deploy infrastructure in other AWS regions</li>

<li>Configure GSLB-capable DNS</li>
</ol>

<p>Infrastructure configurations will vary from shop to shop, but as an example, a read-heavy EC2 application with a single master database for writes should:</p>

<ul>
<li>deploy application servers to all regions</li>

<li>deploy read-only (slave) database servers and/or read caches to all regions</li>

<li>configure application servers to use the slave database servers and/or read caches in their region for reads</li>

<li>configure application servers to use the single master in the &#8220;main&#8221; region for writes</li>
</ul>

<p>This is what such an environment would look like: <img alt='architecture' src='/img/gslb-architecture.gif' /></p>

<p>When configuring servers to communicate across regions (app servers -&gt; master DB; slave DBs -&gt; master DB), you will need to use IP-based rules for your security groups; traffic from the &#8220;app-servers&#8221; security group you set up in eu-west-1 is indistinguishable from other traffic to your DB server in us-east-1. This is because cross-region communication is done using external IP addresses. Your best bet is to either automate security group updates or use Elastic IPs.</p>

<p>Note on more complex configurations: distributed backends are hard (see <a href='http://en.wikipedia.org/wiki/CAP_theorem'>Brewer&#8217;s [CAP] theorem</a>). Multi-region EC2 environments are much easier to implement if your application tolerates the use of 1) regional caches for reads; 2) centralized writes. If you have a choice, stick with the simpler route.</p>

<p>As for configuring DNS, several companies have DNS-based GSLB service offerings:</p>

<ul>
<li><a href='http://dyn.com/dynect'>Dynect</a> - <a href='http://dyn.com/dynect-traffic-management'>Traffic Management</a> (A records only) and <a href='http://dyn.com/dynect-cdn-manager'>CDN Manager</a> (CNAMEs allowed)</li>

<li><a href='http://www.akamai.com/'>Akamai</a> - <a href='http://www.akamai.com/html/technology/products/gtm.html'>Global Traffic Management</a></li>

<li><a href='http://www.ultradns.com/'>UltraDNS</a> - <a href='http://www.ultradns.com/solutions/directionaldns.html'>Directional DNS</a></li>

<li><a href='http://comwired.com/'>Comwired</a>/<a href='http://www.dns.com/'>DNS.com</a> - <a href='http://www.dns.com/location/'>Location Geo-Targeting</a></li>
</ul>

<p>DNS configuration should be pretty similar for the vendors listed above. Basic steps are:</p>

<ol>
<li>
<p>set up regional CNAMEs (us-east-1.example.com, us-west-1.example.com, eu-west-1.example.com, ap-southeast-1.example.com)</p>
</li>

<li>
<p>set up a GSLB-enabled &#8220;master&#8221; CNAME (www.example.com)</p>
</li>

<li>
<p>define the GSLB rules:</p>

<ul>
<li>For users in Asia, return ap-southeast-1.example.com</li>

<li>For users in Europe, return eu-west-1.example.com</li>

<li>For users in Western US, return us-west-1.example.com - &#8230;</li>

<li>For all other users, return us-east-1.example.com</li>
</ul>
</li>
</ol>

<p>If your application is already live, consider abstracting the DNS records by one layer: geo.example.com (master record); us-east-1.geo.example.com, us-west-1.geo.example.com, etc. (regional records). Bring the new configuration live by pointing www.example.com (CNAME) to geo.example.com.</p>

<h3 id='bizos_experiences'>Bizo&#8217;s experiences</h3>

<p>Several of our EC2 applications serve embedded content for customer websites, so it&#8217;s critical we minimize load times. Here&#8217;s the difference we saw on one app after expanding into new regions (from us-east-1 to us-east-1, us-west-1, and eu-west-1) and implementing GSLB (load times provided by <a href='http://browsermob.com/'>BrowserMob</a>):</p>

<p>Load times before GSLB: <img alt='before' src='/img/gslb-response-before.png' /></p>

<p>Load times after GSLB: <img alt='after' src='/img/gslb-response-before.png' /></p>

<p>Reduced load times for everyone far from us-east-1. Users are happy, customers are happy, we&#8217;re happy. Overall, a success.</p>

<p>It&#8217;s interesting to see how the load is distributed throughout the day. Here&#8217;s one application&#8217;s HTTP traffic, broken down by region (ELB stats graphed by <a href='https://github.com/mbabineau/cloudviz'>cloudviz</a>): <img alt='graph' src='/img/gslb-stats.png' /></p>

<p>Note that the use of Elastic Load Balancers and Auto Scaling becomes much more compelling with GSLB. By geographically partitioning users, peak hours are much more localized. This results in a wider difference between peak and trough demand per region; Auto Scaling adjusts capacity transparently, reducing the marginal cost of expanding your infrastructure to multiple AWS regions.</p>

<p>For our GSLB DNS service, we use <a href='http://dyn.com/dynectsales'>Dynect</a> and couldn&#8217;t be more pleased. Intuitive management interface, responsive and helpful support, friendly, no-BS sales. Pricing is based on number of GSLB-enabled domains and DNS query rate. Contact Dynect sales if you want specifics (we work with <a href='http://twitter.com/jadelisle'>Josh Delisle</a> and <a href='https://twitter.com/kyork20'>Kyle York</a> - great guys). Note that those intending to use GSLB with Elastic Load Balancers will need the CDN Management service.</p>

<h3 id='closing_remarks'>Closing remarks</h3>

<p>Previously, operating a global infrastructure required significant overhead. This is where AWS really shines. Amazon now has four regions spread across three continents, and there&#8217;s minimal overhead to distribute your platform across all of them. You just need to add a layer to route users to the closest one.</p>

<p>The use of Amazon CloudFront in conjunction with a global EC2 infrastructure is a killer combo for improving application performance. And with Amazon continually expanding with new AWS regions, it&#8217;s only going to get better.</p>
    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/2010/04/27/cloudgrapher-launched" title="Cloudgrapher Launched">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/2011/01/20/loggly-python" title="loggly-python">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    
  </div>
  
  <div class="span4">
    <h4>Published</h4>
    <div class="date"><span>08 May 2010</span></div>

  
    <h4>Tags</h4>
    <ul class="tag_box">
    
    


  
     
    	<li><a href="/tags.html#aws-ref">aws <span>4</span></a></li>
     
    	<li><a href="/tags.html#ec2-ref">ec2 <span>2</span></a></li>
     
    	<li><a href="/tags.html#gslb-ref">gslb <span>1</span></a></li>
     
    	<li><a href="/tags.html#ops-ref">ops <span>8</span></a></li>
    
  



    </ul>
    
  </div>
</div>


      </div>

      <footer>
        <p>&copy; Mike Babineau 2013
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div> <!-- /container -->

    
  </body>
</html>

